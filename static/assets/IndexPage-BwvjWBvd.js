import{c as Z,X as ye,Y as Ce,a as B,h as ee,b as le,f as we,Z as _e,_ as ge,r as b,$ as Ve,a0 as Ue,o as de,g as ke,a1 as Le,A as fe,e as De,D as Se,a2 as qe,I as D,J as p,K as r,M as t,R as w,S as C,a3 as ve,B as J,O as k,N as S,T as V,U as A,V as P,Q as K,L as he,w as Fe,P as se,a4 as z,a5 as pe,a6 as ne,W as Ae}from"./index-DBb_YM3Q.js";import{a as $e,_ as te,Q as R,b as $,c as oe,d as re,e as E,f as M,g as Be,h as H,i as N,j,C as W,k as ie,l as X,m as Qe,n as Te}from"./date-P9M3-SRv.js";import{api as O}from"./axios-CUZ6h_s0.js";import"./QItem-CMGFRULN.js";const ue=Z({name:"QCardActions",props:{...ye,vertical:Boolean},setup(e,{slots:l}){const d=Ce(e),a=B(()=>`q-card__actions ${d.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>ee("div",{class:a.value},le(l.default))}});function be(){return we(_e)}const ce=ge("users",{state:()=>({users:[],loading:!1}),actions:{async fetchUsers(){this.loading=!0;try{const e=await O.get("/api/users");this.users=e.data.map(l=>({...l,last_called_at:l.last_called_at?new Date(l.last_called_at):null,call_history:l.call_history||[]}))}catch(e){console.error("Failed to fetch users:",e),this.users=[]}finally{this.loading=!1}},async createUser(e){try{const l=await O.post("/api/users",e);return this.users.push({...l.data,last_called_at:null,call_history:[]}),l.data}catch(l){throw console.error("Failed to create user:",l),l}},async updateUser(e,l){try{const d=await O.put(`/api/users/${e}`,l),a=this.users.findIndex(f=>f.phone_number===e);return a!==-1&&(this.users[a]={...d.data,last_called_at:this.users[a].last_called_at,call_history:this.users[a].call_history}),d.data}catch(d){throw console.error("Failed to update user:",d),d}},async deleteUser(e){try{await O.delete(`/api/users/${e}`),this.users=this.users.filter(l=>l.phone_number!==e)}catch(l){throw console.error("Failed to delete user:",l),l}},async recordCall(e,l){try{const d=await O.post(`/api/users/${e}/calls`,l),a=this.users.findIndex(f=>f.phone_number===e);return a!==-1&&(this.users[a].last_called_at=new Date,this.users[a].call_history=[...this.users[a].call_history||[],{timestamp:new Date,...l}]),d.data}catch(d){throw console.error("Failed to record call:",d),d}}}}),Ie=Z({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:l,emit:d}){const a=ke(),f=b(null);let g=0;const n=[];function o(u){const h=typeof u=="boolean"?u:e.noErrorFocus!==!0,U=++g,L=(c,i)=>{d(`validation${c===!0?"Success":"Error"}`,i)},T=c=>{const i=c.validate();return typeof i.then=="function"?i.then(m=>({valid:m,comp:c}),m=>({valid:!1,comp:c,err:m})):Promise.resolve({valid:i,comp:c})};return(e.greedy===!0?Promise.all(n.map(T)).then(c=>c.filter(i=>i.valid!==!0)):n.reduce((c,i)=>c.then(()=>T(i).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(c=>[c])).then(c=>{if(c===void 0||c.length===0)return U===g&&L(!0),!0;if(U===g){const{comp:i,err:m}=c[0];if(m!==void 0&&console.error(m),L(!1,i),h===!0){const y=c.find(({comp:_})=>typeof _.focus=="function"&&Le(_.$)===!1);y!==void 0&&y.comp.focus()}}return!1})}function s(){g++,n.forEach(u=>{typeof u.resetValidation=="function"&&u.resetValidation()})}function v(u){u!==void 0&&fe(u);const h=g+1;o().then(U=>{h===g&&U===!0&&(e.onSubmit!==void 0?d("submit",u):u!==void 0&&u.target!==void 0&&typeof u.target.submit=="function"&&u.target.submit())})}function q(u){u!==void 0&&fe(u),d("reset"),De(()=>{s(),e.autofocus===!0&&e.noResetFocus!==!0&&F()})}function F(){$e(()=>{if(f.value===null)return;const u=f.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||f.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||f.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(f.value.querySelectorAll("[tabindex]"),h=>h.tabIndex!==-1);u?.focus({preventScroll:!0})})}Se(qe,{bindComponent(u){n.push(u)},unbindComponent(u){const h=n.indexOf(u);h!==-1&&n.splice(h,1)}});let Q=!1;return Ve(()=>{Q=!0}),Ue(()=>{Q===!0&&e.autofocus===!0&&F()}),de(()=>{e.autofocus===!0&&F()}),Object.assign(a.proxy,{validate:o,resetValidation:s,submit:v,reset:q,focus:F,getValidationComponents:()=>n}),()=>ee("form",{class:"q-form",ref:f,onSubmit:v,onReset:q},le(l.default))}}),Pe={name:"UserForm",props:{initialData:{type:Object,default:()=>({})},editMode:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(e,{emit:l}){const d=b(!1),a=b({phone_number:"",name:"",comments:""});return de(()=>{e.initialData&&(a.value={...e.initialData})}),{form:a,loading:d,onSubmit:async()=>{d.value=!0;try{l("submit",{...a.value})}finally{d.value=!1}}}}},je={class:"row justify-end q-gutter-sm"};function Ee(e,l,d,a,f,g){return p(),D(Ie,{onSubmit:a.onSubmit,class:"q-gutter-md"},{default:r(()=>[t(R,{modelValue:a.form.phone_number,"onUpdate:modelValue":l[0]||(l[0]=n=>a.form.phone_number=n),label:"Phone Number",rules:[n=>!!n||"Phone number is required"]},null,8,["modelValue","rules"]),t(R,{modelValue:a.form.name,"onUpdate:modelValue":l[1]||(l[1]=n=>a.form.name=n),label:"Name"},null,8,["modelValue"]),t(R,{modelValue:a.form.comments,"onUpdate:modelValue":l[2]||(l[2]=n=>a.form.comments=n),type:"textarea",label:"Comments"},null,8,["modelValue"]),w("div",je,[t(C,{flat:"",label:"Cancel",color:"grey",onClick:l[3]||(l[3]=n=>e.$emit("cancel"))}),t(C,{loading:a.loading,type:"submit",color:"primary",label:d.editMode?"Update":"Create"},null,8,["loading","label"])])]),_:1},8,["onSubmit"])}const Oe=te(Pe,[["render",Ee]]),G=Z({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:l}){const d=B(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>ee("tr",{class:d.value},le(l.default))}}),Re=Z({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:l}){const d=B(()=>{const a=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(f=>e[f]===!0).map(f=>`q-btn-group--${f}`).join(" ");return`q-btn-group row no-wrap${a.length!==0?" "+a:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>ee("div",{class:d.value},le(l.default))}}),He=ge("callList",()=>{const e=b([]),l=b(!1),d=b(0),a=b(!1),f=b(null),g=ce(),n=B(()=>{const u=new Set;return e.value.filter(h=>{const U=u.has(h.phone_number);return u.add(h.phone_number),!U})});function o(u){(Array.isArray(u)?u:[u]).forEach(U=>{e.value.some(L=>L.phone_number===U.phone_number)||e.value.push(U)})}function s(u){e.value=e.value.filter(h=>h.phone_number!==u.phone_number)}function v(u){const h=Array.isArray(u)?u:[u];e.value=e.value.filter(U=>!h.some(L=>L.phone_number===U.phone_number))}async function q(){l.value=!0,d.value=0,a.value=!1;const u=n.value;try{for(const[h,U]of u.entries()){if(a.value)break;d.value=h,f.value=U;const L=await O.post("/make_call",{phone_number:U.phone_number});await g.recordCall(U.phone_number,L.data),await new Promise(T=>setTimeout(T,1e3))}}catch(h){throw console.error("Failed to complete calls:",h),h}finally{l.value=!1,f.value=null,d.value=0,a.value=!1}}function F(){a.value=!0}function Q(){e.value=[]}return{callList:n,calling:l,currentCallIndex:d,currentUser:f,shouldCancelCalls:a,addToCallList:o,removeFromCallList:s,removeSelectedFromCallList:v,callAllInList:q,cancelCalls:F,clearCallList:Q}}),Ne=ve({name:"CallHistoryDialog",props:{modelValue:{type:Boolean,required:!0},user:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:[],setup(e,{emit:l}){const d=ce(),a=B({get:()=>e.modelValue,set:i=>l("update:modelValue",i)}),f=b(!1),g=b(!1),n=b(null),o=b(null),s=b(""),v=b({timestamp:"",call_status:"",call_duration:"",extracted_info:"",actions:""}),q=[{name:"timestamp",required:!0,label:"Date & Time",align:"left",field:"timestamp",format:i=>j(i),sortable:!0},{name:"call_status",required:!0,label:"Status",align:"left",field:"call_status",sortable:!0},{name:"call_duration",label:"Duration",align:"left",field:"call_duration",sortable:!0},{name:"extracted_info",label:"Extracted Information",align:"left",field:"extracted_info",style:"width: 300px"},{name:"actions",label:"Actions",align:"center",field:i=>i}],F=i=>Object.entries(v.value).every(([m,y])=>{if(!y||m==="actions")return!0;const _=y.toLowerCase();let I=i[m];return m==="timestamp"&&I?j(I).toLowerCase().includes(_):m==="extracted_info"?JSON.stringify(I||{}).toLowerCase().includes(_):m==="call_duration"&&I!=null?h(I).toLowerCase().includes(_):String(I||"").toLowerCase().includes(_)}),Q=B(()=>{if(!e.user?.call_history)return[];const i=[...e.user.call_history].sort((y,_)=>new Date(_.timestamp)-new Date(y.timestamp)),m=s.value.toLowerCase();return i.filter(y=>{const _=F(y);if(!m)return _;const I=j(y.timestamp).toLowerCase().includes(m)||String(y.call_status||"").toLowerCase().includes(m)||h(y.call_duration).toLowerCase().includes(m)||JSON.stringify(y.extracted_info||{}).toLowerCase().includes(m);return _&&I})}),u=i=>({completed:"positive",failed:"negative","in-progress":"warning",cancelled:"grey"})[i?.toLowerCase()]||"grey",h=i=>{if(!i)return"-";const m=Math.floor(i/60),y=Math.floor(i%60);return`${m}:${y.toString().padStart(2,"0")}`},U=i=>i.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" "),L=i=>{if(!i)return;const m=i.split("/").pop();o.value=`/recordings/combined/${encodeURIComponent(m)}`,g.value=!0},T=i=>{n.value=i,f.value=!0},x=async()=>{e.user?.phone_number&&await d.fetchUsers()},c=()=>{s.value="",Object.keys(v.value).forEach(i=>{v.value[i]=""})};return Fe(()=>e.modelValue,i=>{i&&c()}),{show:a,filter:s,columns:q,columnFilters:v,filteredCalls:Q,selectedCall:n,showTranscriptionDialog:f,showAudioDialog:g,currentAudioUrl:o,getStatusColor:u,formatDuration:h,formatFieldName:U,playAudio:L,showTranscription:T,clearFilters:c,refreshUserData:x}}}),xe={class:"text-subtitle1 q-mb-md"},ze={class:"row full-width q-gutter-sm"},Me={class:"row full-width q-gutter-sm q-mt-sm"},Ge={key:0,class:"text-caption"},Je={class:"text-weight-medium"},Ke={key:1,class:"text-grey"},We={class:"conversation-text",style:{"white-space":"pre-line"}},Ye=["src"];function Xe(e,l,d,a,f,g){return p(),D(N,{modelValue:e.show,"onUpdate:modelValue":l[3]||(l[3]=n=>e.show=n),maximized:"",onShow:e.refreshUserData},{default:r(()=>[t(H,null,{default:r(()=>[t($,{class:"row items-center q-pb-none"},{default:r(()=>[l[4]||(l[4]=w("div",{class:"text-h6"},"Call History",-1)),t(oe),J(t(C,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1}),t($,null,{default:r(()=>[w("div",xe,k(e.user?.name||e.user?.phone_number),1),t(re,{rows:e.filteredCalls,columns:e.columns,"row-key":"timestamp",loading:e.loading},{top:r(()=>[w("div",ze,[t(R,{dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[0]||(l[0]=n=>e.filter=n),placeholder:"Global search",class:"col-grow",clearable:""},{append:r(()=>[t(K,{name:"search"})]),_:1},8,["modelValue"])]),w("div",Me,[(p(!0),V(A,null,P(e.columns.filter(n=>n.name!=="actions"),n=>(p(),V("div",{key:n.name,class:"col"},[t(R,{dense:"",debounce:"300",modelValue:e.columnFilters[n.name],"onUpdate:modelValue":o=>e.columnFilters[n.name]=o,placeholder:`Filter ${n.label}`,clearable:""},{append:r(()=>[t(K,{name:"filter_alt",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),header:r(n=>[t(G,{props:n},{default:r(()=>[(p(!0),V(A,null,P(n.cols,o=>(p(),D(ie,{key:o.name,props:n},{default:r(()=>[S(k(o.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-call_status":r(n=>[t(E,{props:n},{default:r(()=>[t(Be,{color:e.getStatusColor(n.value),"text-color":"white",dense:"",class:"q-px-sm"},{default:r(()=>[S(k(n.value),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-call_duration":r(n=>[t(E,{props:n},{default:r(()=>[S(k(e.formatDuration(n.value)),1)]),_:2},1032,["props"])]),"body-cell-timestamp":r(n=>[t(E,{props:n},{default:r(()=>[S(k(n.value),1)]),_:2},1032,["props"])]),"body-cell-extracted_info":r(n=>[t(E,{props:n},{default:r(()=>[n.row.extracted_info?(p(),V("div",Ge,[(p(!0),V(A,null,P(n.row.extracted_info,(o,s)=>(p(),V("div",{key:s,class:"extracted-info-item"},[w("span",Je,k(e.formatFieldName(s))+":",1),w("span",null,k(o),1)]))),128))])):(p(),V("span",Ke,"No information extracted"))]),_:2},1032,["props"])]),"body-cell-actions":r(n=>[t(E,{props:n,class:"q-gutter-sm"},{default:r(()=>[t(C,{flat:"",round:"",dense:"",color:"primary",icon:"play_arrow",onClick:o=>e.playAudio(n.row.audio_file_name),disable:!n.row.audio_file_name},{default:r(()=>[t(M,null,{default:r(()=>l[5]||(l[5]=[S("Play Recording")])),_:1})]),_:2},1032,["onClick","disable"]),t(C,{flat:"",round:"",dense:"",color:"info",icon:"chat",onClick:o=>e.showTranscription(n.row),disable:!n.row.conversation},{default:r(()=>[t(M,null,{default:r(()=>l[6]||(l[6]=[S("View Transcription")])),_:1})]),_:2},1032,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1}),t(N,{modelValue:e.showTranscriptionDialog,"onUpdate:modelValue":l[1]||(l[1]=n=>e.showTranscriptionDialog=n)},{default:r(()=>[t(H,{style:{"min-width":"350px","max-width":"600px"}},{default:r(()=>[t($,{class:"row items-center q-pb-none"},{default:r(()=>[l[7]||(l[7]=w("div",{class:"text-h6"},"Call Transcription",-1)),t(oe),J(t(C,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1}),t($,{class:"q-pt-md"},{default:r(()=>[w("div",We,k(e.selectedCall?.conversation),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:e.showAudioDialog,"onUpdate:modelValue":l[2]||(l[2]=n=>e.showAudioDialog=n)},{default:r(()=>[t(H,{style:{"min-width":"350px"}},{default:r(()=>[t($,{class:"row items-center"},{default:r(()=>[l[8]||(l[8]=w("div",{class:"text-h6"},"Call Recording",-1)),t(oe),J(t(C,{icon:"close",flat:"",round:"",dense:""},null,512),[[W]])]),_:1}),t($,{class:"q-pt-none"},{default:r(()=>[e.currentAudioUrl?(p(),V("audio",{key:0,controls:"",class:"full-width",src:e.currentAudioUrl}," Your browser does not support the audio element. ",8,Ye)):he("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","onShow"])}const Ze=te(Ne,[["render",Xe],["__scopeId","data-v-51b9f9c6"]]),el=ve({name:"UsersTable",components:{CallHistoryDialog:Ze},props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["edit","delete","call","bulk-delete"],setup(e,{emit:l}){const d=be(),a=He(),f=b([]),g=b([]),n=b(!1),o=b(null),s=b(""),v=b({select:"",name:"",phone_number:"",created_at:"",last_call:"",actions:""}),q=[{name:"select",label:"",field:"select",sortable:!1,filterable:!1},{name:"name",required:!0,label:"Name",align:"left",field:"name",format:i=>i||"-",sortable:!0,filterable:!0},{name:"phone_number",required:!0,label:"Phone",align:"left",field:"phone_number",sortable:!0,filterable:!0},{name:"created_at",label:"Added On",align:"left",field:"created_at",format:i=>j(i),sortable:!0,filterable:!0},{name:"last_call",label:"Last Call",align:"left",field:i=>i.call_history?.[0]?.timestamp||null,format:i=>i?j(i):"Never",sortable:!0,filterable:!0},{name:"actions",label:"Actions",align:"center",sortable:!1,filterable:!1}],F=i=>i==="actions"?"width: 150px":i==="select"?"width: 50px":"",Q=()=>!Object.values(v.value).some(m=>m&&m.trim()!=="")&&!s.value?()=>!0:m=>Object.entries(v.value).every(([y,_])=>{if(!q.find(me=>me.name===y)?.filterable||!_||_.trim()==="")return!0;const ae=_.toLowerCase();let Y=m[y];return y==="last_call"&&(Y=m.call_history?.[0]?.timestamp),y==="created_at"||y==="last_call"?Y?j(Y).toLowerCase().includes(ae):!1:String(Y||"").toLowerCase().includes(ae)}),u=B(()=>{const i=e.users,m=Q(),y=s.value.toLowerCase();return i.filter(_=>m(_)&&(!y||_.name.toLowerCase().includes(y)||_.phone_number.toLowerCase().includes(y)||j(_.created_at).toLowerCase().includes(y)||_.call_history?.[0]?.timestamp&&j(_.call_history?.[0]?.timestamp).toLowerCase().includes(y)))}),h=()=>{l("bulk-delete",f.value)},U=()=>{a.addToCallList(f.value),f.value=[]},L=i=>{a.removeFromCallList(i)},T=()=>{a.removeSelectedFromCallList(g.value),g.value=[]},x=async()=>{try{await a.callAllInList(),d.notify({type:"positive",message:"All calls completed successfully"})}catch(i){d.notify({type:"negative",message:`Failed to complete calls: ${i.message}`})}},c=i=>{o.value=i,n.value=!0};return{columns:q,selected:f,selectedCallListUsers:g,showCallHistoryDialog:n,selectedUser:o,filter:s,columnFilters:v,callList:B(()=>a.callList),calling:B(()=>a.calling),callListStore:a,filteredUsers:u,onDeleteSelected:h,addSelectedToCallList:U,removeFromCallList:L,removeSelectedFromCallList:T,callAllInList:x,showCallHistory:c,getColumnStyle:F}}}),ll={class:"q-mb-md"},tl={class:"row q-mb-md"},al={class:"row full-width q-gutter-sm"},ol={class:"row full-width q-gutter-sm q-mt-sm"},sl={key:1,class:"q-gutter-sm"},nl={class:"row q-mb-md items-center"},rl={class:"full-width row flex-center text-grey q-gutter-sm q-pa-md"},il={key:0,class:"q-ml-md"},ul={key:1,class:"q-ml-md"};function dl(e,l,d,a,f,g){const n=se("call-history-dialog");return p(),V("div",null,[w("div",ll,[w("div",tl,[t(C,{color:"negative",icon:"delete",label:"Delete Selected",onClick:e.onDeleteSelected,disable:e.selected.length===0,class:"q-mr-sm"},null,8,["onClick","disable"]),t(C,{color:"primary",icon:"add",label:"Add to Call List",onClick:e.addSelectedToCallList,disable:e.selected.length===0,class:"q-mr-sm"},null,8,["onClick","disable"])]),t(re,{rows:e.filteredUsers,columns:e.columns,"row-key":"phone_number",loading:e.loading,selection:"multiple",selected:e.selected,"onUpdate:selected":l[1]||(l[1]=o=>e.selected=o),filter:e.filter},{top:r(()=>[w("div",al,[t(R,{dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[0]||(l[0]=o=>e.filter=o),placeholder:"Global search",class:"col-grow"},{append:r(()=>[t(K,{name:"search"})]),_:1},8,["modelValue"])]),w("div",ol,[(p(!0),V(A,null,P(e.columns,o=>(p(),V("div",{key:o.name,class:z(o.name==="select"||o.name==="actions"?"col-auto":"col")},[o.filterable?(p(),D(R,{key:0,dense:"",debounce:"300",modelValue:e.columnFilters[o.name],"onUpdate:modelValue":s=>e.columnFilters[o.name]=s,placeholder:`Filter ${o.label}`,clearable:"",onInput:e.applyColumnFilters},{append:r(()=>[t(K,{name:"filter_alt",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onInput"])):he("",!0)],2))),128))])]),header:r(o=>[t(G,{props:o},{default:r(()=>[(p(!0),V(A,null,P(o.cols,s=>(p(),D(ie,{key:s.name,props:o,style:pe(e.getColumnStyle(s.name)),class:z({"text-left":s.align==="left","text-center":s.align==="center","text-right":s.align==="right","col-auto":s.name==="select"||s.name==="actions",col:s.name!=="select"&&s.name!=="actions"})},{default:r(()=>[s.name==="select"?(p(),D(X,{key:0,modelValue:o.selected,"onUpdate:modelValue":v=>o.selected=v},null,8,["modelValue","onUpdate:modelValue"])):(p(),V(A,{key:1},[S(k(s.label),1)],64))]),_:2},1032,["props","style","class"]))),128))]),_:2},1032,["props"])]),body:r(o=>[t(G,{props:o},{default:r(()=>[(p(!0),V(A,null,P(o.cols,s=>(p(),D(E,{key:s.name,props:o,class:z({"text-left":s.align==="left","text-center":s.align==="center","text-right":s.align==="right","col-auto":s.name==="select"||s.name==="actions",col:s.name!=="select"&&s.name!=="actions"})},{default:r(()=>[s.name==="select"?(p(),D(X,{key:0,modelValue:o.selected,"onUpdate:modelValue":v=>o.selected=v},null,8,["modelValue","onUpdate:modelValue"])):s.name==="actions"?(p(),V("div",sl,[t(C,{flat:"",round:"",dense:"",color:"info",icon:"history",onClick:v=>e.showCallHistory(o.row),disable:!o.row.call_history?.length},{default:r(()=>[t(M,null,{default:r(()=>l[7]||(l[7]=[S("View Call History")])),_:1})]),_:2},1032,["onClick","disable"]),t(C,{flat:"",round:"",dense:"",color:"primary",icon:"phone",onClick:v=>e.$emit("call",o.row)},{default:r(()=>[t(M,null,{default:r(()=>l[8]||(l[8]=[S("Call Client")])),_:1})]),_:2},1032,["onClick"]),t(C,{flat:"",round:"",dense:"",color:"warning",icon:"edit",onClick:v=>e.$emit("edit",o.row)},{default:r(()=>[t(M,null,{default:r(()=>l[9]||(l[9]=[S("Edit Client")])),_:1})]),_:2},1032,["onClick"]),t(C,{flat:"",round:"",dense:"",color:"negative",icon:"delete",onClick:v=>e.$emit("delete",o.row)},{default:r(()=>[t(M,null,{default:r(()=>l[10]||(l[10]=[S("Delete Client")])),_:1})]),_:2},1032,["onClick"])])):(p(),V(A,{key:2},[S(k(s.format?s.format(o.row[s.field]):o.row[s.field]),1)],64))]),_:2},1032,["props","class"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","selected","filter"])]),w("div",null,[w("div",nl,[l[11]||(l[11]=w("div",{class:"text-h6 q-mr-md"},"Call List",-1)),t(C,{color:"negative",icon:"clear",label:"Clear List",onClick:l[2]||(l[2]=o=>e.callListStore.clearCallList()),disable:e.callList.length===0,class:"q-mr-sm"},null,8,["disable"]),t(C,{color:"negative",icon:"delete",label:"Delete Selected",onClick:e.removeSelectedFromCallList,disable:e.selectedCallListUsers.length===0,class:"q-mr-sm"},null,8,["onClick","disable"]),t(C,{color:"primary",icon:"phone",label:"Call All",onClick:e.callAllInList,disable:e.callList.length===0||e.calling,loading:e.calling},null,8,["onClick","disable","loading"])]),t(re,{rows:e.callList,columns:e.columns,"row-key":"phone_number",selection:"multiple",selected:e.selectedCallListUsers,"onUpdate:selected":l[3]||(l[3]=o=>e.selectedCallListUsers=o)},{header:r(o=>[t(G,{props:o},{default:r(()=>[(p(!0),V(A,null,P(o.cols,s=>(p(),D(ie,{key:s.name,props:o,style:pe(e.getColumnStyle(s.name)),class:z({"text-left":s.align==="left","text-center":s.align==="center","text-right":s.align==="right","col-auto":s.name==="select"||s.name==="actions",col:s.name!=="select"&&s.name!=="actions"})},{default:r(()=>[s.name==="select"?(p(),D(X,{key:0,modelValue:o.selected,"onUpdate:modelValue":v=>o.selected=v},null,8,["modelValue","onUpdate:modelValue"])):(p(),V(A,{key:1},[S(k(s.label),1)],64))]),_:2},1032,["props","style","class"]))),128))]),_:2},1032,["props"])]),body:r(o=>[t(G,{props:o},{default:r(()=>[(p(!0),V(A,null,P(o.cols,s=>(p(),D(E,{key:s.name,props:o,class:z({"text-left":s.align==="left","text-center":s.align==="center","text-right":s.align==="right","col-auto":s.name==="select"||s.name==="actions",col:s.name!=="select"&&s.name!=="actions"})},{default:r(()=>[s.name==="select"?(p(),D(X,{key:0,modelValue:o.selected,"onUpdate:modelValue":v=>o.selected=v},null,8,["modelValue","onUpdate:modelValue"])):s.name==="actions"?(p(),D(Re,{key:1,flat:""},{default:r(()=>[t(C,{flat:"",round:"",color:"negative",icon:"delete",onClick:v=>e.removeFromCallList(o.row)},null,8,["onClick"]),t(C,{flat:"",round:"",color:"secondary",icon:"phone",onClick:v=>e.$emit("call",o.row)},null,8,["onClick"])]),_:2},1024)):(p(),V(A,{key:2},[S(k(s.format?s.format(o.row[s.field]):o.row[s.field]),1)],64))]),_:2},1032,["props","class"]))),128))]),_:2},1032,["props"])]),"no-data":r(()=>[w("div",rl,[t(K,{size:"2em",name:"list"}),l[12]||(l[12]=w("span",null,"No clients in call list",-1))])]),_:1},8,["rows","columns","selected"])]),t(N,{persistent:"",modelValue:e.callListStore.calling,"onUpdate:modelValue":l[5]||(l[5]=o=>e.callListStore.calling=o)},{default:r(()=>[t(H,{style:{"min-width":"350px"}},{default:r(()=>[t($,{class:"row items-center"},{default:r(()=>[t(ne,{icon:"phone",color:"primary","text-color":"white"}),e.callListStore.currentUser?(p(),V("span",il," Calling "+k(e.callListStore.currentUser.name||e.callListStore.currentUser.phone_number)+" ("+k(e.callListStore.currentCallIndex+1)+" of "+k(e.callList.length)+") ",1)):(p(),V("span",ul," Initializing calls... "))]),_:1}),t($,null,{default:r(()=>[t(Qe,{value:e.callList.length?(e.callListStore.currentCallIndex+1)/e.callList.length:0,color:"primary",class:"q-mt-md"},null,8,["value"])]),_:1}),t(ue,{align:"right"},{default:r(()=>[t(C,{flat:"",label:"Cancel Remaining",color:"negative",onClick:l[4]||(l[4]=o=>e.callListStore.cancelCalls()),disable:e.callListStore.shouldCancelCalls},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(n,{modelValue:e.showCallHistoryDialog,"onUpdate:modelValue":l[6]||(l[6]=o=>e.showCallHistoryDialog=o),user:e.selectedUser,loading:!1},null,8,["modelValue","user"])])}const cl=te(el,[["render",dl],["__scopeId","data-v-8d96b85a"]]),ml={name:"UsersPage",components:{UserForm:Oe,UsersTable:cl},setup(){const e=be(),l=ce(),d=b(!1),a=b(!1),f=b(!1),g=b(null),n=b(null),o=b(!1),s=b(!1),v=b(null),q=()=>{d.value=!1,f.value=!1,g.value=null,n.value=null,o.value=!1},F=c=>{g.value={...c},o.value=!0,d.value=!0},Q=c=>{g.value=c,n.value=null,a.value=!0},u=c=>{n.value=c,g.value=null,a.value=!0},h=async()=>{try{if(n.value){for(const c of n.value)await l.deleteUser(c.phone_number);e.notify({type:"positive",message:`${n.value.length} clients deleted successfully`}),v.value&&(v.value.selected=[])}else await l.deleteUser(g.value.phone_number),e.notify({type:"positive",message:"Client deleted successfully"});a.value=!1,g.value=null,n.value=null}catch(c){console.error("Delete error:",c),e.notify({type:"negative",message:`Failed to delete client(s): ${c.message}`})}},U=c=>{g.value=c,f.value=!0},L=async()=>{s.value=!0;try{const c=await O.post("/make_call",{phone_number:g.value.phone_number});await l.recordCall(g.value.phone_number,c.data),e.notify({type:"positive",message:`Call to ${g.value.name||g.value.phone_number} completed successfully`}),f.value=!1}catch(c){console.error("Call error:",c),e.notify({type:"negative",message:`Failed to make call: ${c.message}`})}finally{s.value=!1,g.value=null}},T=B(()=>({persistent:!0,seamless:!1,"no-click-outside":!0})),x=async c=>{try{o.value?(await l.updateUser(g.value.phone_number,c),e.notify({type:"positive",message:"Client updated successfully"})):(await l.createUser(c),e.notify({type:"positive",message:"Client added successfully"})),q()}catch(i){console.error("Submit error:",i),e.notify({type:"negative",message:`${o.value?"Failed to update":"Failed to add"} client: ${i.message}`})}};return de(()=>{l.fetchUsers()}),{users:B(()=>l.users),loading:B(()=>l.loading),showAddDialog:d,showDeleteDialog:a,showCallDialog:f,selectedUser:g,bulkDeleteUsers:n,editMode:o,calling:s,callDialogProps:T,closeDialog:q,editUser:F,confirmDelete:Q,confirmBulkDelete:u,deleteUser:h,makeCall:U,confirmCall:L,onSubmit:x,usersTableRef:v}}},fl={class:"row items-center justify-between q-mb-md"},pl={class:"text-h6"},gl={class:"q-ml-sm"},vl={class:"q-ml-sm"};function hl(e,l,d,a,f,g){const n=se("users-table"),o=se("user-form");return p(),D(Te,{padding:"",class:"full-width"},{default:r(()=>[w("div",fl,[l[4]||(l[4]=w("h1",{class:"text-h4 q-my-none"},"Clients",-1)),t(C,{color:"primary",icon:"add",label:"Add Client",onClick:l[0]||(l[0]=s=>a.showAddDialog=!0)})]),t(n,{users:a.users,loading:a.loading,onEdit:a.editUser,onDelete:a.confirmDelete,onCall:a.makeCall,onBulkDelete:a.confirmBulkDelete,ref:"usersTableRef",class:"full-width"},null,8,["users","loading","onEdit","onDelete","onCall","onBulkDelete"]),t(N,{modelValue:a.showAddDialog,"onUpdate:modelValue":l[1]||(l[1]=s=>a.showAddDialog=s)},{default:r(()=>[t(H,{style:{"min-width":"350px"}},{default:r(()=>[t($,null,{default:r(()=>[w("div",pl,k(a.editMode?"Edit Client":"Add Client"),1)]),_:1}),t($,null,{default:r(()=>[t(o,{"initial-data":a.selectedUser,"edit-mode":a.editMode,onSubmit:a.onSubmit,onCancel:a.closeDialog},null,8,["initial-data","edit-mode","onSubmit","onCancel"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{modelValue:a.showDeleteDialog,"onUpdate:modelValue":l[2]||(l[2]=s=>a.showDeleteDialog=s)},{default:r(()=>[t(H,null,{default:r(()=>[t($,{class:"row items-center"},{default:r(()=>[t(ne,{icon:"warning",color:"negative","text-color":"white"}),w("span",gl,k(a.bulkDeleteUsers?`Are you sure you want to delete ${a.bulkDeleteUsers.length} selected clients?`:"Are you sure you want to delete this client?"),1)]),_:1}),t(ue,{align:"right"},{default:r(()=>[J(t(C,{flat:"",label:"Cancel",color:"primary"},null,512),[[W]]),t(C,{flat:"",label:"Delete",color:"negative",onClick:a.deleteUser},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,Ae({modelValue:a.showCallDialog,"onUpdate:modelValue":l[3]||(l[3]=s=>a.showCallDialog=s)},a.callDialogProps,{class:"call-dialog"}),{default:r(()=>[t(H,{class:z({"calling-card":a.calling}),style:{"min-width":"350px"}},{default:r(()=>[t($,{class:"row items-center"},{default:r(()=>[t(ne,{icon:"phone",color:"primary","text-color":"white"}),w("span",vl,"Confirm call to "+k(a.selectedUser?.name||a.selectedUser?.phone_number)+"?",1)]),_:1}),t(ue,{align:"right"},{default:r(()=>[J(t(C,{flat:"",label:"Cancel",color:"primary",disable:a.calling},null,8,["disable"]),[[W]]),t(C,{loading:a.calling,flat:"",label:"Call",color:"positive",onClick:a.confirmCall,disable:a.calling},null,8,["loading","onClick","disable"])]),_:1})]),_:1},8,["class"])]),_:1},16,["modelValue"])]),_:1})}const _l=te(ml,[["render",hl],["__scopeId","data-v-030d6bde"]]);export{_l as default};
