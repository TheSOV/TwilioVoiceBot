import{_ as $,Q as b,o as x,e as g,f as U,g as z,d as G,h as q,b as v,c as T,i as I,j as N,C as Q,n as J}from"./date-_-7UGAzB.js";import{_ as W,a3 as D,T as u,J as d,R as r,M as a,r as f,w as Y,K as o,S as V,N as C,U as k,V as A,O as _,Q as K,B as P,L as X,a as E,I as Z,o as ee,P as L}from"./index-BZv83KRg.js";import{api as le}from"./axios-DBtND7IV.js";import"./QItem-wFMsqSmA.js";const S=W("callHistory",{state:()=>({callHistories:[],loading:!1,error:null,filters:{startDate:null,endDate:null,phoneNumber:"",callStatus:"",extractedInfoKeyword:""}}),actions:{async fetchCallHistories(){this.loading=!0,this.error=null;try{const e=await le.get("/api/call_histories",{params:{start_date:this.filters.startDate,end_date:this.filters.endDate,phone_number:this.filters.phoneNumber,call_status:this.filters.callStatus,extracted_info_keyword:this.filters.extractedInfoKeyword}});this.callHistories=e.data}catch(e){this.error=e.response?.data?.detail||"Failed to fetch call histories",console.error("Error fetching call histories:",e)}finally{this.loading=!1}},setFilter(e,t){this.filters[e]=t},clearFilters(){this.filters={startDate:null,endDate:null,phoneNumber:"",callStatus:"",extractedInfoKeyword:""}}}}),te=D({name:"CallHistoryFilter",setup(){const e=S(),t=f({phoneNumber:"",callStatus:null,extractedInfoKeyword:"",startDate:null,endDate:null}),m=["completed","failed","in-progress","canceled"],p=()=>{Object.keys(t.value).forEach(c=>{e.setFilter(c,t.value[c])}),e.fetchCallHistories()};return Y(()=>e.filters,c=>{t.value={...c}},{immediate:!0}),{localFilters:t,callStatusOptions:m,applyFilters:p}}}),ae={class:"call-history-filter"},oe={class:"row q-col-gutter-md"},se={class:"col-12 col-md-3"},re={class:"col-12 col-md-3"},ne={class:"col-12 col-md-3"},ie={class:"col-12 col-md-3"},de={class:"row q-col-gutter-sm"},ce={class:"col-6"},ue={class:"col-6"};function me(e,t,m,p,c,w){return d(),u("div",ae,[r("div",oe,[r("div",se,[a(b,{modelValue:e.localFilters.phoneNumber,"onUpdate:modelValue":[t[0]||(t[0]=l=>e.localFilters.phoneNumber=l),e.applyFilters],label:"Phone Number",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",re,[a(x,{modelValue:e.localFilters.callStatus,"onUpdate:modelValue":[t[1]||(t[1]=l=>e.localFilters.callStatus=l),e.applyFilters],options:e.callStatusOptions,label:"Call Status",dense:"",clearable:""},null,8,["modelValue","options","onUpdate:modelValue"])]),r("div",ne,[a(b,{modelValue:e.localFilters.extractedInfoKeyword,"onUpdate:modelValue":[t[2]||(t[2]=l=>e.localFilters.extractedInfoKeyword=l),e.applyFilters],label:"Extracted Info Keyword",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",ie,[r("div",de,[r("div",ce,[a(b,{modelValue:e.localFilters.startDate,"onUpdate:modelValue":[t[3]||(t[3]=l=>e.localFilters.startDate=l),e.applyFilters],label:"Start Date",type:"date",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",ue,[a(b,{modelValue:e.localFilters.endDate,"onUpdate:modelValue":[t[4]||(t[4]=l=>e.localFilters.endDate=l),e.applyFilters],label:"End Date",type:"date",dense:"",clearable:""},null,8,["modelValue","onUpdate:modelValue"])])])])])])}const pe=$(te,[["render",me],["__scopeId","data-v-0533d0b2"]]),fe=D({name:"CallHistoryTable",setup(){const e=S(),t=[{name:"phone_number",required:!0,label:"Phone Number",align:"left",field:"phone_number",sortable:!0},{name:"timestamp",required:!0,label:"Date & Time",align:"left",field:"timestamp",format:s=>N(s),sortable:!0},{name:"call_status",required:!0,label:"Status",align:"left",field:"call_status",sortable:!0},{name:"call_duration",label:"Duration",align:"left",field:"call_duration",format:s=>H(s),sortable:!0},{name:"extracted_info",label:"Extracted Info",align:"left",field:"extracted_info",sortable:!1},{name:"actions",label:"Actions",align:"center",field:"actions",sortable:!1}],m=f(""),p=f({}),c=E(()=>{let s=e.callHistories;if(m.value){const n=m.value.toLowerCase();s=s.filter(h=>Object.values(h).some(F=>String(F).toLowerCase().includes(n)))}return Object.keys(p.value).forEach(n=>{const h=p.value[n];if(h){const F=h.toLowerCase();s=s.filter(R=>String(R[n]).toLowerCase().includes(F))}}),s}),w=f(!1),l=f(!1),i=f(null),y=f(null),j=s=>{i.value=s,w.value=!0},B=s=>{if(!s)return;const n=s.split("/").pop();y.value=`/recordings/combined/${encodeURIComponent(n)}`,l.value=!0},O=s=>({completed:"positive",failed:"negative","in-progress":"warning",canceled:"grey"})[s?.toLowerCase()]||"grey",H=s=>{if(!s)return"-";const n=Math.floor(s/60),h=Math.floor(s%60);return`${n}:${h.toString().padStart(2,"0")}`},M=s=>s.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ");return{callHistories:c,loading:E(()=>e.loading),columns:t,filter:m,columnFilters:p,showTranscriptionDialog:w,showAudioDialog:l,selectedCall:i,currentAudioUrl:y,showTranscription:j,playAudio:B,getStatusColor:O,formatDuration:H,formatFieldName:M,formatDateWithTimezone:N}}}),he={class:"row full-width q-gutter-sm"},be={class:"row full-width q-gutter-sm q-mt-sm"},we={key:0,class:"text-caption"},ye={class:"text-weight-medium"},_e={class:"q-ml-xs"},ge={key:1,class:"text-grey"},ve={class:"conversation-text",style:{"white-space":"pre-line"}},Ve=["src"];function Ce(e,t,m,p,c,w){return d(),u("div",null,[a(G,{rows:e.callHistories,columns:e.columns,loading:e.loading,"row-key":"timestamp",class:"full-width"},{top:o(()=>[r("div",he,[a(b,{dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":t[0]||(t[0]=l=>e.filter=l),placeholder:"Global search",class:"col-grow",clearable:""},{append:o(()=>[a(K,{name:"search"})]),_:1},8,["modelValue"])]),r("div",be,[(d(!0),u(k,null,A(e.columns.filter(l=>l.name!=="actions"),l=>(d(),u("div",{key:l.name,class:"col"},[a(b,{dense:"",debounce:"300",modelValue:e.columnFilters[l.name],"onUpdate:modelValue":i=>e.columnFilters[l.name]=i,placeholder:`Filter ${l.label}`,clearable:""},{append:o(()=>[a(K,{name:"filter_alt",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),"body-cell-call_status":o(l=>[a(g,{props:l},{default:o(()=>[a(z,{color:e.getStatusColor(l.value),"text-color":"white",dense:"",class:"q-px-sm"},{default:o(()=>[C(_(l.value),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-call_duration":o(l=>[a(g,{props:l},{default:o(()=>[C(_(e.formatDuration(l.value)),1)]),_:2},1032,["props"])]),"body-cell-extracted_info":o(l=>[a(g,{props:l},{default:o(()=>[l.row.extracted_info?(d(),u("div",we,[(d(!0),u(k,null,A(l.row.extracted_info,(i,y)=>(d(),u("div",{key:y,class:"extracted-info-item"},[r("span",ye,_(e.formatFieldName(y))+":",1),r("span",_e,_(i),1)]))),128))])):(d(),u("span",ge,"No information extracted"))]),_:2},1032,["props"])]),"body-cell-actions":o(l=>[a(g,{props:l,class:"q-gutter-sm"},{default:o(()=>[a(V,{flat:"",round:"",dense:"",color:"primary",icon:"play_arrow",onClick:i=>e.playAudio(l.row.audio_file_name),disable:!l.row.audio_file_name},{default:o(()=>[a(U,null,{default:o(()=>t[3]||(t[3]=[C("Play Recording")])),_:1})]),_:2},1032,["onClick","disable"]),a(V,{flat:"",round:"",dense:"",color:"info",icon:"chat",onClick:i=>e.showTranscription(l.row),disable:!l.row.conversation},{default:o(()=>[a(U,null,{default:o(()=>t[4]||(t[4]=[C("View Transcription")])),_:1})]),_:2},1032,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"]),a(I,{modelValue:e.showTranscriptionDialog,"onUpdate:modelValue":t[1]||(t[1]=l=>e.showTranscriptionDialog=l)},{default:o(()=>[a(q,{style:{"min-width":"350px","max-width":"600px"}},{default:o(()=>[a(v,{class:"row items-center q-pb-none"},{default:o(()=>[t[5]||(t[5]=r("div",{class:"text-h6"},"Call Transcription",-1)),a(T),P(a(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[Q]])]),_:1}),a(v,{class:"q-pt-md"},{default:o(()=>[r("div",ve,_(e.selectedCall?.conversation),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(I,{modelValue:e.showAudioDialog,"onUpdate:modelValue":t[2]||(t[2]=l=>e.showAudioDialog=l)},{default:o(()=>[a(q,{style:{"min-width":"350px"}},{default:o(()=>[a(v,{class:"row items-center"},{default:o(()=>[t[6]||(t[6]=r("div",{class:"text-h6"},"Call Recording",-1)),a(T),P(a(V,{icon:"close",flat:"",round:"",dense:""},null,512),[[Q]])]),_:1}),a(v,{class:"q-pt-none"},{default:o(()=>[e.currentAudioUrl?(d(),u("audio",{key:0,controls:"",class:"full-width",src:e.currentAudioUrl}," Your browser does not support the audio element. ",8,Ve)):X("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const Fe=$(fe,[["render",Ce],["__scopeId","data-v-409ff47d"]]),$e=D({name:"CallHistoryPage",components:{CallHistoryFilter:pe,CallHistoryTable:Fe},setup(){const e=S();return ee(()=>{e.fetchCallHistories()}),{}}});function De(e,t,m,p,c,w){const l=L("call-history-filter"),i=L("call-history-table");return d(),Z(J,{padding:"",class:"full-width"},{default:o(()=>[t[0]||(t[0]=r("div",{class:"row items-center justify-between q-mb-md"},[r("h1",{class:"text-h4 q-my-none"},"Call History")],-1)),a(l),a(i)]),_:1})}const Te=$($e,[["render",De],["__scopeId","data-v-232dbe52"]]);export{Te as default};
