import{c as Y,X as ge,Y as he,a as F,h as X,b as Z,f as ye,Z as Ce,_ as de,r as b,$ as we,a0 as _e,o as ne,g as Le,a1 as De,A as ue,e as Se,D as Ue,a2 as Ve,I as j,J as w,K as s,M as t,R as y,S as h,a3 as ce,B as M,O as D,N as A,T as S,U as z,V as G,Q as J,L as me,w as ke,P as te,a4 as qe,a5 as fe,a6 as ae,W as Fe}from"./index-D_yOce4Y.js";import{a as Ae,_ as x,Q as E,b as q,c as le,d as oe,e as I,f as N,g as $e,h as O,i as R,j as T,C as K,k as pe,l as Be,m as Qe,n as Te}from"./date-BQBkjt7h.js";import{api as P}from"./axios-gUTcy4Fe.js";import"./QItem-BgfWO-nl.js";const se=Y({name:"QCardActions",props:{...ge,vertical:Boolean},setup(e,{slots:l}){const u=he(e),a=F(()=>`q-card__actions ${u.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>X("div",{class:a.value},Z(l.default))}});function ve(){return ye(Ce)}const re=de("users",{state:()=>({users:[],loading:!1}),actions:{async fetchUsers(){this.loading=!0;try{const e=await P.get("/api/users");this.users=e.data.map(l=>({...l,last_called_at:l.last_called_at?new Date(l.last_called_at):null,call_history:l.call_history||[]}))}catch(e){console.error("Failed to fetch users:",e),this.users=[]}finally{this.loading=!1}},async createUser(e){try{const l=await P.post("/api/users",e);return this.users.push({...l.data,last_called_at:null,call_history:[]}),l.data}catch(l){throw console.error("Failed to create user:",l),l}},async updateUser(e,l){try{const u=await P.put(`/api/users/${e}`,l),a=this.users.findIndex(f=>f.phone_number===e);return a!==-1&&(this.users[a]={...u.data,last_called_at:this.users[a].last_called_at,call_history:this.users[a].call_history}),u.data}catch(u){throw console.error("Failed to update user:",u),u}},async deleteUser(e){try{await P.delete(`/api/users/${e}`),this.users=this.users.filter(l=>l.phone_number!==e)}catch(l){throw console.error("Failed to delete user:",l),l}},async recordCall(e,l){try{const u=await P.post(`/api/users/${e}/calls`,l),a=this.users.findIndex(f=>f.phone_number===e);return a!==-1&&(this.users[a].last_called_at=new Date,this.users[a].call_history=[...this.users[a].call_history||[],{timestamp:new Date,...l}]),u.data}catch(u){throw console.error("Failed to record call:",u),u}}}}),Ie=Y({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:l,emit:u}){const a=Le(),f=b(null);let p=0;const o=[];function n(i){const v=typeof i=="boolean"?i:e.noErrorFocus!==!0,_=++p,U=(d,r)=>{u(`validation${d===!0?"Success":"Error"}`,r)},B=d=>{const r=d.validate();return typeof r.then=="function"?r.then(m=>({valid:m,comp:d}),m=>({valid:!1,comp:d,err:m})):Promise.resolve({valid:r,comp:d})};return(e.greedy===!0?Promise.all(o.map(B)).then(d=>d.filter(r=>r.valid!==!0)):o.reduce((d,r)=>d.then(()=>B(r).then(m=>{if(m.valid===!1)return Promise.reject(m)})),Promise.resolve()).catch(d=>[d])).then(d=>{if(d===void 0||d.length===0)return _===p&&U(!0),!0;if(_===p){const{comp:r,err:m}=d[0];if(m!==void 0&&console.error(m),U(!1,r),v===!0){const g=d.find(({comp:C})=>typeof C.focus=="function"&&De(C.$)===!1);g!==void 0&&g.comp.focus()}}return!1})}function c(){p++,o.forEach(i=>{typeof i.resetValidation=="function"&&i.resetValidation()})}function L(i){i!==void 0&&ue(i);const v=p+1;n().then(_=>{v===p&&_===!0&&(e.onSubmit!==void 0?u("submit",i):i!==void 0&&i.target!==void 0&&typeof i.target.submit=="function"&&i.target.submit())})}function V(i){i!==void 0&&ue(i),u("reset"),Se(()=>{c(),e.autofocus===!0&&e.noResetFocus!==!0&&k()})}function k(){Ae(()=>{if(f.value===null)return;const i=f.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||f.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||f.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(f.value.querySelectorAll("[tabindex]"),v=>v.tabIndex!==-1);i?.focus({preventScroll:!0})})}Ue(Ve,{bindComponent(i){o.push(i)},unbindComponent(i){const v=o.indexOf(i);v!==-1&&o.splice(v,1)}});let $=!1;return we(()=>{$=!0}),_e(()=>{$===!0&&e.autofocus===!0&&k()}),ne(()=>{e.autofocus===!0&&k()}),Object.assign(a.proxy,{validate:n,resetValidation:c,submit:L,reset:V,focus:k,getValidationComponents:()=>o}),()=>X("form",{class:"q-form",ref:f,onSubmit:L,onReset:V},Z(l.default))}}),Pe={name:"UserForm",props:{initialData:{type:Object,default:()=>({})},editMode:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(e,{emit:l}){const u=b(!1),a=b({phone_number:"",name:"",comments:""});return ne(()=>{e.initialData&&(a.value={...e.initialData})}),{form:a,loading:u,onSubmit:async()=>{u.value=!0;try{l("submit",{...a.value})}finally{u.value=!1}}}}},je={class:"row justify-end q-gutter-sm"};function Ee(e,l,u,a,f,p){return w(),j(Ie,{onSubmit:a.onSubmit,class:"q-gutter-md"},{default:s(()=>[t(E,{modelValue:a.form.phone_number,"onUpdate:modelValue":l[0]||(l[0]=o=>a.form.phone_number=o),label:"Phone Number",rules:[o=>!!o||"Phone number is required"]},null,8,["modelValue","rules"]),t(E,{modelValue:a.form.name,"onUpdate:modelValue":l[1]||(l[1]=o=>a.form.name=o),label:"Name"},null,8,["modelValue"]),t(E,{modelValue:a.form.comments,"onUpdate:modelValue":l[2]||(l[2]=o=>a.form.comments=o),type:"textarea",label:"Comments"},null,8,["modelValue"]),y("div",je,[t(h,{flat:"",label:"Cancel",color:"grey",onClick:l[3]||(l[3]=o=>e.$emit("cancel"))}),t(h,{loading:a.loading,type:"submit",color:"primary",label:u.editMode?"Update":"Create"},null,8,["loading","label"])])]),_:1},8,["onSubmit"])}const Oe=x(Pe,[["render",Ee]]),be=Y({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:l}){const u=F(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>X("tr",{class:u.value},Z(l.default))}}),Re=Y({name:"QBtnGroup",props:{unelevated:Boolean,outline:Boolean,flat:Boolean,rounded:Boolean,square:Boolean,push:Boolean,stretch:Boolean,glossy:Boolean,spread:Boolean},setup(e,{slots:l}){const u=F(()=>{const a=["unelevated","outline","flat","rounded","square","push","stretch","glossy"].filter(f=>e[f]===!0).map(f=>`q-btn-group--${f}`).join(" ");return`q-btn-group row no-wrap${a.length!==0?" "+a:""}`+(e.spread===!0?" q-btn-group--spread":" inline")});return()=>X("div",{class:u.value},Z(l.default))}}),He=de("callList",()=>{const e=b([]),l=b(!1),u=b(0),a=b(!1),f=b(null),p=re(),o=F(()=>{const i=new Set;return e.value.filter(v=>{const _=i.has(v.phone_number);return i.add(v.phone_number),!_})});function n(i){(Array.isArray(i)?i:[i]).forEach(_=>{e.value.some(U=>U.phone_number===_.phone_number)||e.value.push(_)})}function c(i){e.value=e.value.filter(v=>v.phone_number!==i.phone_number)}function L(i){const v=Array.isArray(i)?i:[i];e.value=e.value.filter(_=>!v.some(U=>U.phone_number===_.phone_number))}async function V(){l.value=!0,u.value=0,a.value=!1;const i=o.value;try{for(const[v,_]of i.entries()){if(a.value)break;u.value=v,f.value=_;const U=await P.post("/make_call",{phone_number:_.phone_number});await p.recordCall(_.phone_number,U.data),await new Promise(B=>setTimeout(B,1e3))}}catch(v){throw console.error("Failed to complete calls:",v),v}finally{l.value=!1,f.value=null,u.value=0,a.value=!1}}function k(){a.value=!0}function $(){e.value=[]}return{callList:o,calling:l,currentCallIndex:u,currentUser:f,shouldCancelCalls:a,addToCallList:n,removeFromCallList:c,removeSelectedFromCallList:L,callAllInList:V,cancelCalls:k,clearCallList:$}}),Ne=ce({name:"CallHistoryDialog",props:{modelValue:{type:Boolean,required:!0},user:{type:Object,required:!0},loading:{type:Boolean,default:!1}},emits:[],setup(e,{emit:l}){const u=re(),a=F({get:()=>e.modelValue,set:r=>l("update:modelValue",r)}),f=b(!1),p=b(!1),o=b(null),n=b(null),c=b(""),L=b({timestamp:"",call_status:"",call_duration:"",extracted_info:"",actions:""}),V=[{name:"timestamp",required:!0,label:"Date & Time",align:"left",field:"timestamp",format:r=>T(r),sortable:!0},{name:"call_status",required:!0,label:"Status",align:"left",field:"call_status",sortable:!0},{name:"call_duration",label:"Duration",align:"left",field:"call_duration",sortable:!0},{name:"extracted_info",label:"Extracted Information",align:"left",field:"extracted_info",style:"width: 300px"},{name:"actions",label:"Actions",align:"center",field:r=>r}],k=r=>Object.entries(L.value).every(([m,g])=>{if(!g||m==="actions")return!0;const C=g.toLowerCase();let Q=r[m];return m==="timestamp"&&Q?T(Q).toLowerCase().includes(C):m==="extracted_info"?JSON.stringify(Q||{}).toLowerCase().includes(C):m==="call_duration"&&Q!=null?v(Q).toLowerCase().includes(C):String(Q||"").toLowerCase().includes(C)}),$=F(()=>{if(!e.user?.call_history)return[];const r=[...e.user.call_history].sort((g,C)=>new Date(C.timestamp)-new Date(g.timestamp)),m=c.value.toLowerCase();return r.filter(g=>{const C=k(g);if(!m)return C;const Q=T(g.timestamp).toLowerCase().includes(m)||String(g.call_status||"").toLowerCase().includes(m)||v(g.call_duration).toLowerCase().includes(m)||JSON.stringify(g.extracted_info||{}).toLowerCase().includes(m);return C&&Q})}),i=r=>({completed:"positive",failed:"negative","in-progress":"warning",cancelled:"grey"})[r?.toLowerCase()]||"grey",v=r=>{if(!r)return"-";const m=Math.floor(r/60),g=Math.floor(r%60);return`${m}:${g.toString().padStart(2,"0")}`},_=r=>r.split("_").map(m=>m.charAt(0).toUpperCase()+m.slice(1)).join(" "),U=r=>{if(!r)return;const m=r.split("/").pop();n.value=`/recordings/combined/${encodeURIComponent(m)}`,p.value=!0},B=r=>{o.value=r,f.value=!0},H=async()=>{e.user?.phone_number&&await u.fetchUsers()},d=()=>{c.value="",Object.keys(L.value).forEach(r=>{L.value[r]=""})};return ke(()=>e.modelValue,r=>{r&&d()}),{show:a,filter:c,columns:V,columnFilters:L,filteredCalls:$,selectedCall:o,showTranscriptionDialog:f,showAudioDialog:p,currentAudioUrl:n,getStatusColor:i,formatDuration:v,formatFieldName:_,playAudio:U,showTranscription:B,clearFilters:d,refreshUserData:H}}}),ze={class:"text-subtitle1 q-mb-md"},Me={class:"row full-width q-gutter-sm"},Ge={class:"row full-width q-gutter-sm q-mt-sm"},Je={key:0,class:"text-caption"},Ke={class:"text-weight-medium"},We={key:1,class:"text-grey"},Ye={class:"conversation-text",style:{"white-space":"pre-line"}},Xe=["src"];function Ze(e,l,u,a,f,p){return w(),j(R,{modelValue:e.show,"onUpdate:modelValue":l[3]||(l[3]=o=>e.show=o),maximized:"",onShow:e.refreshUserData},{default:s(()=>[t(O,null,{default:s(()=>[t(q,{class:"row items-center q-pb-none"},{default:s(()=>[l[4]||(l[4]=y("div",{class:"text-h6"},"Call History",-1)),t(le),M(t(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[K]])]),_:1}),t(q,null,{default:s(()=>[y("div",ze,D(e.user?.name||e.user?.phone_number),1),t(oe,{rows:e.filteredCalls,columns:e.columns,"row-key":"timestamp",loading:e.loading},{top:s(()=>[y("div",Me,[t(E,{dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[0]||(l[0]=o=>e.filter=o),placeholder:"Global search",class:"col-grow",clearable:""},{append:s(()=>[t(J,{name:"search"})]),_:1},8,["modelValue"])]),y("div",Ge,[(w(!0),S(z,null,G(e.columns.filter(o=>o.name!=="actions"),o=>(w(),S("div",{key:o.name,class:"col"},[t(E,{dense:"",debounce:"300",modelValue:e.columnFilters[o.name],"onUpdate:modelValue":n=>e.columnFilters[o.name]=n,placeholder:`Filter ${o.label}`,clearable:""},{append:s(()=>[t(J,{name:"filter_alt",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]))),128))])]),header:s(o=>[t(be,{props:o},{default:s(()=>[(w(!0),S(z,null,G(o.cols,n=>(w(),j(pe,{key:n.name,props:o},{default:s(()=>[A(D(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"body-cell-call_status":s(o=>[t(I,{props:o},{default:s(()=>[t($e,{color:e.getStatusColor(o.value),"text-color":"white",dense:"",class:"q-px-sm"},{default:s(()=>[A(D(o.value),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-call_duration":s(o=>[t(I,{props:o},{default:s(()=>[A(D(e.formatDuration(o.value)),1)]),_:2},1032,["props"])]),"body-cell-timestamp":s(o=>[t(I,{props:o},{default:s(()=>[A(D(o.value),1)]),_:2},1032,["props"])]),"body-cell-extracted_info":s(o=>[t(I,{props:o},{default:s(()=>[o.row.extracted_info?(w(),S("div",Je,[(w(!0),S(z,null,G(o.row.extracted_info,(n,c)=>(w(),S("div",{key:c,class:"extracted-info-item"},[y("span",Ke,D(e.formatFieldName(c))+":",1),y("span",null,D(n),1)]))),128))])):(w(),S("span",We,"No information extracted"))]),_:2},1032,["props"])]),"body-cell-actions":s(o=>[t(I,{props:o,class:"q-gutter-sm"},{default:s(()=>[t(h,{flat:"",round:"",dense:"",color:"primary",icon:"play_arrow",onClick:n=>e.playAudio(o.row.audio_file_name),disable:!o.row.audio_file_name},{default:s(()=>[t(N,null,{default:s(()=>l[5]||(l[5]=[A("Play Recording")])),_:1})]),_:2},1032,["onClick","disable"]),t(h,{flat:"",round:"",dense:"",color:"info",icon:"chat",onClick:n=>e.showTranscription(o.row),disable:!o.row.conversation},{default:s(()=>[t(N,null,{default:s(()=>l[6]||(l[6]=[A("View Transcription")])),_:1})]),_:2},1032,["onClick","disable"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"])]),_:1})]),_:1}),t(R,{modelValue:e.showTranscriptionDialog,"onUpdate:modelValue":l[1]||(l[1]=o=>e.showTranscriptionDialog=o)},{default:s(()=>[t(O,{style:{"min-width":"350px","max-width":"600px"}},{default:s(()=>[t(q,{class:"row items-center q-pb-none"},{default:s(()=>[l[7]||(l[7]=y("div",{class:"text-h6"},"Call Transcription",-1)),t(le),M(t(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[K]])]),_:1}),t(q,{class:"q-pt-md"},{default:s(()=>[y("div",Ye,D(e.selectedCall?.conversation),1)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:e.showAudioDialog,"onUpdate:modelValue":l[2]||(l[2]=o=>e.showAudioDialog=o)},{default:s(()=>[t(O,{style:{"min-width":"350px"}},{default:s(()=>[t(q,{class:"row items-center"},{default:s(()=>[l[8]||(l[8]=y("div",{class:"text-h6"},"Call Recording",-1)),t(le),M(t(h,{icon:"close",flat:"",round:"",dense:""},null,512),[[K]])]),_:1}),t(q,{class:"q-pt-none"},{default:s(()=>[e.currentAudioUrl?(w(),S("audio",{key:0,controls:"",class:"full-width",src:e.currentAudioUrl}," Your browser does not support the audio element. ",8,Xe)):me("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","onShow"])}const xe=x(Ne,[["render",Ze],["__scopeId","data-v-51b9f9c6"]]),el=ce({name:"UsersTable",components:{CallHistoryDialog:xe},props:{users:{type:Array,required:!0},loading:{type:Boolean,default:!1}},emits:["edit","delete","call","bulk-delete"],setup(e,{emit:l}){const u=ve(),a=He(),f=b([]),p=b([]),o=b(!1),n=b(null),c=b(""),L=b({select:"",name:"",phone_number:"",created_at:"",last_call:"",actions:""}),V=[{name:"select",label:"",field:"select",sortable:!1,filterable:!1},{name:"name",required:!0,label:"Name",align:"left",field:"name",format:r=>r||"-",sortable:!0,filterable:!0},{name:"phone_number",required:!0,label:"Phone",align:"left",field:"phone_number",sortable:!0,filterable:!0},{name:"created_at",label:"Added On",align:"left",field:"created_at",format:r=>T(r),sortable:!0,filterable:!0},{name:"last_call",label:"Last Call",align:"left",field:r=>r.call_history?.[0]?.timestamp||null,format:r=>r?T(r):"Never",sortable:!0,filterable:!0},{name:"actions",label:"Actions",align:"center",sortable:!1,filterable:!1}],k=r=>r==="actions"?"width: 150px":"",$=()=>!Object.values(L.value).some(m=>m&&m.trim()!=="")&&!c.value?()=>!0:m=>Object.entries(L.value).every(([g,C])=>{if(!V.find(ie=>ie.name===g)?.filterable||!C||C.trim()==="")return!0;const ee=C.toLowerCase();let W=m[g];return g==="last_call"&&(W=m.call_history?.[0]?.timestamp),g==="created_at"||g==="last_call"?W?T(W).toLowerCase().includes(ee):!1:String(W||"").toLowerCase().includes(ee)}),i=F(()=>{const r=e.users,m=$(),g=c.value.toLowerCase();return r.filter(C=>m(C)&&(!g||C.name.toLowerCase().includes(g)||C.phone_number.toLowerCase().includes(g)||T(C.created_at).toLowerCase().includes(g)||C.call_history?.[0]?.timestamp&&T(C.call_history?.[0]?.timestamp).toLowerCase().includes(g)))}),v=()=>{l("bulk-delete",f.value)},_=()=>{a.addToCallList(f.value),f.value=[]},U=r=>{a.removeFromCallList(r)},B=()=>{a.removeSelectedFromCallList(p.value),p.value=[]},H=async()=>{try{await a.callAllInList(),u.notify({type:"positive",message:"All calls completed successfully"})}catch(r){u.notify({type:"negative",message:`Failed to complete calls: ${r.message}`})}},d=r=>{n.value=r,o.value=!0};return{columns:V,selected:f,selectedCallListUsers:p,showCallHistoryDialog:o,selectedUser:n,filter:c,columnFilters:L,callList:F(()=>a.callList),calling:F(()=>a.calling),callListStore:a,filteredUsers:i,onDeleteSelected:v,addSelectedToCallList:_,removeFromCallList:U,removeSelectedFromCallList:B,callAllInList:H,showCallHistory:d,getColumnStyle:k}}}),ll={class:"q-mb-md"},tl={class:"row q-mb-md"},al={class:"row full-width q-gutter-sm"},ol={class:"row full-width q-gutter-sm q-mt-sm"},sl={class:"row q-mb-md items-center"},nl={class:"full-width row flex-center text-grey q-gutter-sm q-pa-md"},rl={key:0,class:"q-ml-md"},il={key:1,class:"q-ml-md"};function ul(e,l,u,a,f,p){const o=te("call-history-dialog");return w(),S("div",null,[y("div",ll,[y("div",tl,[t(h,{color:"negative",icon:"delete",label:"Delete Selected",onClick:e.onDeleteSelected,disable:e.selected.length===0,class:"q-mr-sm"},null,8,["onClick","disable"]),t(h,{color:"primary",icon:"add",label:"Add to Call List",onClick:e.addSelectedToCallList,disable:e.selected.length===0,class:"q-mr-sm"},null,8,["onClick","disable"])]),t(oe,{rows:e.filteredUsers,columns:e.columns,"row-key":"phone_number",loading:e.loading,selection:"multiple",selected:e.selected,"onUpdate:selected":l[1]||(l[1]=n=>e.selected=n),filter:e.filter},{top:s(()=>[y("div",al,[t(E,{dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[0]||(l[0]=n=>e.filter=n),placeholder:"Global search",class:"col-grow"},{append:s(()=>[t(J,{name:"search"})]),_:1},8,["modelValue"])]),y("div",ol,[(w(!0),S(z,null,G(e.columns,n=>(w(),S("div",{key:n.name,class:fe(n.name==="select"||n.name==="actions"?"col-auto":"col")},[n.filterable?(w(),j(E,{key:0,dense:"",debounce:"300",modelValue:e.columnFilters[n.name],"onUpdate:modelValue":c=>e.columnFilters[n.name]=c,placeholder:`Filter ${n.label}`,clearable:"",onInput:e.applyColumnFilters},{append:s(()=>[t(J,{name:"filter_alt",size:"xs"})]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","onInput"])):me("",!0)],2))),128))])]),header:s(n=>[t(be,{props:n},{default:s(()=>[(w(!0),S(z,null,G(n.cols,c=>(w(),j(pe,{key:c.name,props:n,style:qe(e.getColumnStyle(c.name))},{default:s(()=>[c.name==="select"?(w(),j(Be,{key:0,modelValue:n.selected,"onUpdate:modelValue":L=>n.selected=L},null,8,["modelValue","onUpdate:modelValue"])):(w(),S(z,{key:1},[A(D(c.label),1)],64))]),_:2},1032,["props","style"]))),128))]),_:2},1032,["props"])]),"body-cell-actions":s(n=>[t(I,{props:n,class:"q-gutter-sm"},{default:s(()=>[t(h,{flat:"",round:"",dense:"",color:"info",icon:"history",onClick:c=>e.showCallHistory(n.row),disable:!n.row.call_history?.length},{default:s(()=>[t(N,null,{default:s(()=>l[7]||(l[7]=[A("View Call History")])),_:1})]),_:2},1032,["onClick","disable"]),t(h,{flat:"",round:"",dense:"",color:"primary",icon:"phone",onClick:c=>e.$emit("call",n.row)},{default:s(()=>[t(N,null,{default:s(()=>l[8]||(l[8]=[A("Call Client")])),_:1})]),_:2},1032,["onClick"]),t(h,{flat:"",round:"",dense:"",color:"warning",icon:"edit",onClick:c=>e.$emit("edit",n.row)},{default:s(()=>[t(N,null,{default:s(()=>l[9]||(l[9]=[A("Edit Client")])),_:1})]),_:2},1032,["onClick"]),t(h,{flat:"",round:"",dense:"",color:"negative",icon:"delete",onClick:c=>e.$emit("delete",n.row)},{default:s(()=>[t(N,null,{default:s(()=>l[10]||(l[10]=[A("Delete Client")])),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading","selected","filter"])]),y("div",null,[y("div",sl,[l[11]||(l[11]=y("div",{class:"text-h6 q-mr-md"},"Call List",-1)),t(h,{color:"negative",icon:"clear",label:"Clear List",onClick:l[2]||(l[2]=n=>e.callListStore.clearCallList()),disable:e.callList.length===0,class:"q-mr-sm"},null,8,["disable"]),t(h,{color:"negative",icon:"delete",label:"Delete Selected",onClick:e.removeSelectedFromCallList,disable:e.selectedCallListUsers.length===0,class:"q-mr-sm"},null,8,["onClick","disable"]),t(h,{color:"primary",icon:"phone",label:"Call All",onClick:e.callAllInList,disable:e.callList.length===0||e.calling,loading:e.calling},null,8,["onClick","disable","loading"])]),t(oe,{rows:e.callList,columns:e.columns,"row-key":"phone_number",selection:"multiple",selected:e.selectedCallListUsers,"onUpdate:selected":l[3]||(l[3]=n=>e.selectedCallListUsers=n)},{"body-cell-actions":s(n=>[t(I,{props:n},{default:s(()=>[t(Re,{flat:""},{default:s(()=>[t(h,{flat:"",round:"",color:"negative",icon:"delete",onClick:c=>e.removeFromCallList(n.row)},null,8,["onClick"]),t(h,{flat:"",round:"",color:"secondary",icon:"phone",onClick:c=>e.$emit("call",n.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),"no-data":s(()=>[y("div",nl,[t(J,{size:"2em",name:"list"}),l[12]||(l[12]=y("span",null,"No clients in call list",-1))])]),_:1},8,["rows","columns","selected"])]),t(R,{persistent:"",modelValue:e.callListStore.calling,"onUpdate:modelValue":l[5]||(l[5]=n=>e.callListStore.calling=n)},{default:s(()=>[t(O,{style:{"min-width":"350px"}},{default:s(()=>[t(q,{class:"row items-center"},{default:s(()=>[t(ae,{icon:"phone",color:"primary","text-color":"white"}),e.callListStore.currentUser?(w(),S("span",rl," Calling "+D(e.callListStore.currentUser.name||e.callListStore.currentUser.phone_number)+" ("+D(e.callListStore.currentCallIndex+1)+" of "+D(e.callList.length)+") ",1)):(w(),S("span",il," Initializing calls... "))]),_:1}),t(q,null,{default:s(()=>[t(Qe,{value:e.callList.length?(e.callListStore.currentCallIndex+1)/e.callList.length:0,color:"primary",class:"q-mt-md"},null,8,["value"])]),_:1}),t(se,{align:"right"},{default:s(()=>[t(h,{flat:"",label:"Cancel Remaining",color:"negative",onClick:l[4]||(l[4]=n=>e.callListStore.cancelCalls()),disable:e.callListStore.shouldCancelCalls},null,8,["disable"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(o,{modelValue:e.showCallHistoryDialog,"onUpdate:modelValue":l[6]||(l[6]=n=>e.showCallHistoryDialog=n),user:e.selectedUser,loading:!1},null,8,["modelValue","user"])])}const dl=x(el,[["render",ul],["__scopeId","data-v-6d7d490b"]]),cl={name:"UsersPage",components:{UserForm:Oe,UsersTable:dl},setup(){const e=ve(),l=re(),u=b(!1),a=b(!1),f=b(!1),p=b(null),o=b(null),n=b(!1),c=b(!1),L=b(null),V=()=>{u.value=!1,f.value=!1,p.value=null,o.value=null,n.value=!1},k=d=>{p.value={...d},n.value=!0,u.value=!0},$=d=>{p.value=d,o.value=null,a.value=!0},i=d=>{o.value=d,p.value=null,a.value=!0},v=async()=>{try{if(o.value){for(const d of o.value)await l.deleteUser(d.phone_number);e.notify({type:"positive",message:`${o.value.length} clients deleted successfully`}),L.value&&(L.value.selected=[])}else await l.deleteUser(p.value.phone_number),e.notify({type:"positive",message:"Client deleted successfully"});a.value=!1,p.value=null,o.value=null}catch(d){console.error("Delete error:",d),e.notify({type:"negative",message:`Failed to delete client(s): ${d.message}`})}},_=d=>{p.value=d,f.value=!0},U=async()=>{c.value=!0;try{const d=await P.post("/make_call",{phone_number:p.value.phone_number});await l.recordCall(p.value.phone_number,d.data),e.notify({type:"positive",message:`Call to ${p.value.name||p.value.phone_number} completed successfully`}),f.value=!1}catch(d){console.error("Call error:",d),e.notify({type:"negative",message:`Failed to make call: ${d.message}`})}finally{c.value=!1,p.value=null}},B=F(()=>({persistent:!0,seamless:!1,"no-click-outside":!0})),H=async d=>{try{n.value?(await l.updateUser(p.value.phone_number,d),e.notify({type:"positive",message:"Client updated successfully"})):(await l.createUser(d),e.notify({type:"positive",message:"Client added successfully"})),V()}catch(r){console.error("Submit error:",r),e.notify({type:"negative",message:`${n.value?"Failed to update":"Failed to add"} client: ${r.message}`})}};return ne(()=>{l.fetchUsers()}),{users:F(()=>l.users),loading:F(()=>l.loading),showAddDialog:u,showDeleteDialog:a,showCallDialog:f,selectedUser:p,bulkDeleteUsers:o,editMode:n,calling:c,callDialogProps:B,closeDialog:V,editUser:k,confirmDelete:$,confirmBulkDelete:i,deleteUser:v,makeCall:_,confirmCall:U,onSubmit:H,usersTableRef:L}}},ml={class:"row items-center justify-between q-mb-md"},fl={class:"text-h6"},pl={class:"q-ml-sm"},vl={class:"q-ml-sm"};function bl(e,l,u,a,f,p){const o=te("users-table"),n=te("user-form");return w(),j(Te,{padding:"",class:"full-width"},{default:s(()=>[y("div",ml,[l[4]||(l[4]=y("h1",{class:"text-h4 q-my-none"},"Clients",-1)),t(h,{color:"primary",icon:"add",label:"Add Client",onClick:l[0]||(l[0]=c=>a.showAddDialog=!0)})]),t(o,{users:a.users,loading:a.loading,onEdit:a.editUser,onDelete:a.confirmDelete,onCall:a.makeCall,onBulkDelete:a.confirmBulkDelete,ref:"usersTableRef",class:"full-width"},null,8,["users","loading","onEdit","onDelete","onCall","onBulkDelete"]),t(R,{modelValue:a.showAddDialog,"onUpdate:modelValue":l[1]||(l[1]=c=>a.showAddDialog=c)},{default:s(()=>[t(O,{style:{"min-width":"350px"}},{default:s(()=>[t(q,null,{default:s(()=>[y("div",fl,D(a.editMode?"Edit Client":"Add Client"),1)]),_:1}),t(q,null,{default:s(()=>[t(n,{"initial-data":a.selectedUser,"edit-mode":a.editMode,onSubmit:a.onSubmit,onCancel:a.closeDialog},null,8,["initial-data","edit-mode","onSubmit","onCancel"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:a.showDeleteDialog,"onUpdate:modelValue":l[2]||(l[2]=c=>a.showDeleteDialog=c)},{default:s(()=>[t(O,null,{default:s(()=>[t(q,{class:"row items-center"},{default:s(()=>[t(ae,{icon:"warning",color:"negative","text-color":"white"}),y("span",pl,D(a.bulkDeleteUsers?`Are you sure you want to delete ${a.bulkDeleteUsers.length} selected clients?`:"Are you sure you want to delete this client?"),1)]),_:1}),t(se,{align:"right"},{default:s(()=>[M(t(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[K]]),t(h,{flat:"",label:"Delete",color:"negative",onClick:a.deleteUser},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,Fe({modelValue:a.showCallDialog,"onUpdate:modelValue":l[3]||(l[3]=c=>a.showCallDialog=c)},a.callDialogProps,{class:"call-dialog"}),{default:s(()=>[t(O,{class:fe({"calling-card":a.calling}),style:{"min-width":"350px"}},{default:s(()=>[t(q,{class:"row items-center"},{default:s(()=>[t(ae,{icon:"phone",color:"primary","text-color":"white"}),y("span",vl,"Confirm call to "+D(a.selectedUser?.name||a.selectedUser?.phone_number)+"?",1)]),_:1}),t(se,{align:"right"},{default:s(()=>[M(t(h,{flat:"",label:"Cancel",color:"primary",disable:a.calling},null,8,["disable"]),[[K]]),t(h,{loading:a.calling,flat:"",label:"Call",color:"positive",onClick:a.confirmCall,disable:a.calling},null,8,["loading","onClick","disable"])]),_:1})]),_:1},8,["class"])]),_:1},16,["modelValue"])]),_:1})}const wl=x(cl,[["render",bl],["__scopeId","data-v-030d6bde"]]);export{wl as default};
